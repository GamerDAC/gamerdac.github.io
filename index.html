<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scratch Project Player</title>
<style>
  body {
    background: #111;
    color: white;
    font-family: sans-serif;
    text-align: center;
  }
  canvas {
    background: white;
    border: 2px solid #444;
  }
  button {
    font-size: 16px;
    margin: 5px;
    padding: 6px 12px;
  }
</style>
</head>
<body>

<h2>Scratch Project Player</h2>

<canvas id="stage" width="480" height="360"></canvas><br>

<input type="file" id="fileInput" accept=".sb3">
<br>
<button id="greenFlag">▶ Green Flag</button>
<button id="stopAll">■ Stop</button>

<!-- Scratch libraries -->
<script src="https://unpkg.com/scratch-vm@latest/dist/web/scratch-vm.js"></script>
<script src="https://unpkg.com/scratch-render@latest/dist/web/scratch-render.js"></script>
<script src="https://unpkg.com/scratch-audio@latest/dist/web/scratch-audio.js"></script>
<script src="https://unpkg.com/scratch-storage@latest/dist/web/scratch-storage.js"></script>

<script>
const canvas = document.getElementById("stage");

const vm = new window.ScratchVM();
const renderer = new window.ScratchRender(canvas);
const audioEngine = new window.ScratchAudio.SoundEngine();
const storage = new window.ScratchStorage();

vm.attachRenderer(renderer);
vm.attachAudioEngine(audioEngine);
vm.attachStorage(storage);

// Asset loaders
storage.addWebStore(
  [storage.AssetType.Project],
  () => {}
);
storage.addWebStore(
  [storage.AssetType.ImageVector, storage.AssetType.ImageBitmap, storage.AssetType.Sound],
  () => {}
);

// Run VM
vm.start();

// Load sb3
document.getElementById("fileInput").addEventListener("change", async e => {
  const file = e.target.files[0];
  if (!file) return;

  const buffer = await file.arrayBuffer();
  await vm.loadProject(buffer);
  vm.greenFlag();
});

// Controls
document.getElementById("greenFlag").onclick = () => vm.greenFlag();
document.getElementById("stopAll").onclick = () => vm.stopAll();
</script>

</body>
</html>
